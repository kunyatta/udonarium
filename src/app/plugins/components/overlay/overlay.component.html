<div class="overlay-content-wrapper" 
  [style.left]="left"
  [style.top]="top"
  [style.width]="width"
  [style.height]="height"
  [style.z-index]="zIndex"
  [style.opacity]="opacity"
  [style.transform]="transform"
  [style.transition]="transition"
  [class.has-frame]="hasFrame" (click)="closeLocal()">
  
  <!-- 演出ロジック専用の要素（Angularのバインドを持たせない） -->
  <div #effectTarget class="effect-target">
    
    <ng-container [ngSwitch]="overlayObject?.type">
      
      <!-- Video (YouTube) -->
      <ng-container *ngSwitchCase="'video'">
        <youtube-player 
          *ngIf="videoId && isVisible"
          [videoId]="videoId"
          [width]="videoWidth"
          [height]="videoHeight"
          [playerVars]="{ autoplay: 1, rel: 0, controls: 0, loop: 0 }"
          (ready)="onPlayerReady($event)"
          (stateChange)="onPlayerStateChange($event)">
        </youtube-player>
        <!-- Click surface to catch events on top of the iframe -->
        <div class="video-click-surface"></div>
        <div *ngIf="!videoId && overlayObject?.isDebug" style="color: red; background: white; padding: 10px;">VIDEO ID NOT SET</div>
      </ng-container>

      <!-- Image (New Standard) -->
      <ng-container *ngSwitchCase="'image'">
        <img *ngIf="imageUrl" [src]="imageUrl" draggable="false">
        <div *ngIf="!imageUrl && overlayObject?.isDebug" style="color: red; background: white; padding: 10px;">IMAGE NOT SET</div>
      </ng-container>

      <!-- Standing Stage (Global Director Mode) -->
      <ng-container *ngSwitchCase="'standing-stage'">
        <ng-container *ngFor="let actor of stageActors">
          <ng-container *ngIf="getActorData(actor); let data">
            <div class="standing-unit-wrapper stage-actor"
                 [style.left]="data.left + 'vw'"
                 [style.bottom]="'0'"
                 [style.opacity]="data.opacity"
                 [style.height]="data.height + 'vh'"
                 [class.is-left]="data.side === 'left'" 
                 [class.is-right]="data.side === 'right'"
                 [class.is-disappearing]="data.isDisappearing"
                 [style.transition]="'all 500ms ease-out'"
                 (click)="dismissActor(actor); $event.stopPropagation()">
              
              <!-- Character Image -->
              <div class="standing-character" 
                   [style.width]="data.width + 'vw'" 
                   [style.height]="'100%'">
                <img [src]="getActorImageUrl(data.imageIdentifier)" draggable="false">
              </div>


              <!-- Standing Info Layer (Speech & Emote Stack) -->
              <div class="standing-info-container">
                <!-- Speech Bubble -->
                <div *ngIf="data.speechVisible && data.speechText" class="standing-speech"
                     [style.transform]="'translate(' + data.speechOffsetX + 'vw, -' + data.speechOffsetY + 'vh)'">
                   <div class="speech-bubble" 
                        [class.pos-left]="data.side === 'left'"
                        [class.pos-right]="data.side === 'right'">
                     {{ getVisibleSpeechText(actor) }}
                   </div>
                </div>
              </div>

              <!-- Floating Emote -->
              <div *ngIf="data.emoteVisible && data.emoteText" class="standing-emote"
                   [style.transform]="'translate(' + data.emoteOffsetX + 'vw, -' + data.emoteOffsetY + 'vh)'">
                <div class="emote-float-wrapper">
                  <div class="emote-inner">
                    {{ data.emoteText }}
                  </div>
                </div>
              </div>

            </div>
          </ng-container>
        </ng-container>
      </ng-container>

      <ng-container *ngSwitchDefault>
        <div class="generic-content">
          {{ overlayObject?.label || 'No Label' }}
        </div>
      </ng-container>

    </ng-container>

  </div>

  <!-- デバッグ表示 -->
  <div *ngIf="overlayObject?.isDebug" class="debug-info">
    Type: {{ overlayObject?.type }}<br>
    Op: {{ overlayObject?.opacity }}<br>
    IsMine: {{ overlayObject?.isMine }}
  </div>
</div>