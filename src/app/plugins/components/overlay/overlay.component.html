<div class="overlay-content-wrapper" 
  [style.left]="left"
  [style.top]="top"
  [style.width]="width"
  [style.height]="height"
  [style.z-index]="zIndex"
  [style.opacity]="opacity"
  [style.transform]="transform"
  [style.transition]="transition"
  [class.has-frame]="hasFrame" (click)="closeLocal()">
  
  <!-- 演出ロジック専用の要素（Angularのバインドを持たせない） -->
  <div #effectTarget class="effect-target">
    
    <ng-container [ngSwitch]="overlayObject?.type">
      
      <!-- Video (YouTube) -->
      <ng-container *ngSwitchCase="'video'">
        <youtube-player 
          *ngIf="videoId && isVisible"
          [videoId]="videoId"
          [width]="videoWidth"
          [height]="videoHeight"
          [playerVars]="{ autoplay: 1, rel: 0, controls: 0, loop: 0 }"
          (ready)="onPlayerReady($event)"
          (stateChange)="onPlayerStateChange($event)">
        </youtube-player>
        <!-- Click surface to catch events on top of the iframe -->
        <div class="video-click-surface"></div>
        <div *ngIf="!videoId && overlayObject?.isDebug" style="color: red; background: white; padding: 10px;">VIDEO ID NOT SET</div>
      </ng-container>

      <!-- Image (New Standard) -->
      <ng-container *ngSwitchCase="'image'">
        <img *ngIf="imageUrl" [src]="imageUrl" draggable="false">
        <div *ngIf="!imageUrl && overlayObject?.isDebug" style="color: red; background: white; padding: 10px;">IMAGE NOT SET</div>
      </ng-container>

      <!-- Standing Unit (Combined Object) -->
      <ng-container *ngSwitchCase="'standing-unit'">
        <div class="standing-unit-wrapper" 
             [class.is-left]="standingSide === 'left'" 
             [class.is-right]="standingSide === 'right'"
             [class.inertia-left]="inertiaState === 'left'"
             [class.inertia-right]="inertiaState === 'right'">
          
          <!-- Character Image -->
          <div class="standing-character">
            <img *ngIf="imageUrl" [src]="imageUrl" draggable="false">
          </div>

          <!-- Standing Info Layer (Speech & Emote Stack) -->
          <div class="standing-info-container">
            <!-- Speech Bubble -->
            <div *ngIf="standingSpeechVisible && visibleSpeechText" class="standing-speech">
               <div class="speech-bubble" 
                    [class.pos-left]="standingSide === 'left'"
                    [class.pos-right]="standingSide === 'right'">
                 {{ visibleSpeechText }}
               </div>
            </div>

            <!-- Floating Emote -->
            <div *ngIf="standingEmoteVisible && standingEmoteText" class="standing-emote">
              <div class="emote-float-wrapper">
                <div class="emote-inner">
                  {{ standingEmoteText }}
                </div>
              </div>
            </div>
          </div>

        </div>
      </ng-container>

      <ng-container *ngSwitchDefault>
        <div class="generic-content">
          {{ overlayObject?.label || 'No Label' }}
        </div>
      </ng-container>

    </ng-container>

  </div>

  <!-- デバッグ表示 -->
  <div *ngIf="overlayObject?.isDebug" class="debug-info">
    Type: {{ overlayObject?.type }}<br>
    Op: {{ overlayObject?.opacity }}<br>
    IsMine: {{ overlayObject?.isMine }}
  </div>
</div>