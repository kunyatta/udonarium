<div class="container">
  <div class="tab-header">
    <button 
      [class.active]="activeTab === 'settings'" 
      (click)="activeTab = 'settings'">
      設定
    </button>
    <button 
      [class.active]="activeTab === 'status-effects'" 
      (click)="activeTab = 'status-effects'">
      ステータス効果管理
    </button>
  </div>

  <div class="tab-content" [class.no-padding]="activeTab === 'status-effects'">
    
    <!-- =============================================== -->
    <!-- 設定タブ                                        -->
    <!-- =============================================== -->
    <div [hidden]="activeTab !== 'settings'" class="settings-panel">
      
      <h4>表示パラメータ設定</h4>
      <p>カードに表示するパラメータのタグ名をスペース区切りで入力します。(例: HP MP 敏捷度)</p>
      <input type="text" class="param-input" [ngModel]="displayDataTags" (ngModelChange)="onDisplayDataTagsChange($event)" placeholder="例: HP MP 敏捷度">
      <hr>

      <h4>チャット設定</h4>
      <div class="form-group">
        <label>ログ出力先タブ</label>
        <select [(ngModel)]="messageTargetTabId" (ngModelChange)="onMessageTargetTabChange($event)" class="param-input">
          <option *ngFor="let tab of availableChatTabs" [value]="tab.identifier">{{ tab.name }}</option>
        </select>
      </div>
      <div class="form-group">
        <label>システムログ送信元</label>
        <select [(ngModel)]="selectedLogSenderName" (ngModelChange)="onSystemLogSenderNameChange($event)" class="param-input">
          <option value="">指定なし（操作者）</option>
          <option *ngFor="let char of (availableLogSenders$ | async)" [value]="char.name">{{ char.name }}</option>
        </select>
      </div>
      <hr>

      <h4>パネル操作</h4>
      <div class="buttons">
        <button (click)="toggleCombatPanel()">戦闘パネル 表示/非表示</button>
      </div>
      <hr>

      <h4>ダメージ適用確認設定</h4>
      <div class="form-group">
        <label>軽減参照パラメータ</label>
        <input type="text" class="param-input" [(ngModel)]="damageCheckConfig.referenceParams" (change)="saveDamageCheckConfig()" placeholder="例: 防護点">
      </div>
      <div class="checkbox-group">
        <label class="checkbox-label">
          <input type="checkbox" [checked]="damageCheckConfig.buttonConfig.showAsIs" (change)="toggleDamageCheckButton('showAsIs')"> 「そのまま」ボタン
        </label>
        <label class="checkbox-label">
          <input type="checkbox" [checked]="damageCheckConfig.buttonConfig.showReduce" (change)="toggleDamageCheckButton('showReduce')"> 「軽減」ボタン
        </label>
        <label class="checkbox-label">
          <input type="checkbox" [checked]="damageCheckConfig.buttonConfig.showHalve" (change)="toggleDamageCheckButton('showHalve')"> 「半減」ボタン
        </label>
        <label class="checkbox-label">
          <input type="checkbox" [checked]="damageCheckConfig.buttonConfig.showZero" (change)="toggleDamageCheckButton('showZero')"> 「無効」ボタン
        </label>
        <label class="checkbox-label">
          <input type="checkbox" [checked]="damageCheckConfig.buttonConfig.showCustom" (change)="toggleDamageCheckButton('showCustom')"> 「カスタム」入力
        </label>
      </div>
      <hr>
    </div>

    <!-- =============================================== -->
    <!-- ステータス効果管理タブ (2カラム)                -->
    <!-- =============================================== -->
    <div [hidden]="activeTab !== 'status-effects'" class="two-column-container">
      
      <!-- 左カラム: サイドバー (リスト) -->
      <div class="sidebar">
        <div class="sidebar-header">
          <button class="full-width primary" (click)="createNewEffect()">+ 新規作成</button>
        </div>
        <div class="effect-list">
          <div *ngFor="let effect of statusEffectTemplates; let i = index"
               class="effect-item"
               [class.selected]="selectedEffectIndex === i"
               (click)="selectEffect(i)">
            <span class="effect-icon-preview">
              <span *ngIf="effect.emoji">{{ effect.emoji }}</span>
            </span>
            <span class="effect-name">{{ effect.name }}</span>
          </div>
        </div>
        <div class="sidebar-footer">
          <button class="full-width" (click)="exportStatusEffectDictionaryAsZip()">辞書を一括保存</button>
        </div>
      </div>

      <!-- 右カラム: メイン (エディタ) -->
      <div class="main-content">
        <!-- エディタヘッダー -->
        <div class="editor-header" *ngIf="editingEffect">
          <div class="header-buttons">
            <button class="primary" (click)="saveEffect()">反映</button>
            <button (click)="exportSingleEffectAsZip()">個別保存</button>
          </div>
          <button class="danger" (click)="deleteEffect()" [disabled]="selectedEffectIndex < 0">削除</button>
        </div>

        <!-- エディタ本体 -->
        <div class="edit-panel" *ngIf="editingEffect">
          
          <!-- 基本情報セクション -->
          <div class="form-section">
            <div class="form-group">
              <label for="effect-name">名前</label>
              <input id="effect-name" type="text" class="param-input" [(ngModel)]="editingEffect.name" placeholder="例: 毒">
            </div>

            <div class="form-row">
              <div class="form-group icon-group">
                <label for="effect-emoji">絵文字</label>
                <div class="input-with-preview">
                  <input id="effect-emoji" type="text" class="param-input" [(ngModel)]="editingEffect.emoji" placeholder="例: ☠️" maxlength="2">
                  <span class="icon-preview">{{ editingEffect.emoji }}</span>
                </div>
              </div>
          
              <div class="form-group duration-group">
                <label>持続ラウンド</label>
                <div class="input-with-checkbox">
                  <input id="effect-duration" type="number" class="param-input" [(ngModel)]="editingEffect.duration" [disabled]="editingEffect.isPermanent">
                  <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="editingEffect.isPermanent"> 永遠
                  </label>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="effect-description">説明</label>
              <textarea id="effect-description" class="param-input" rows="3" [(ngModel)]="editingEffect.description" placeholder="ツールチップで表示される説明文"></textarea>
            </div>
          </div>

          <hr>

          <!-- 視覚効果セクション -->
          <div class="form-section">
            <h4>視覚効果</h4>
            
            <div class="form-group">
              <label>フィルター効果（複数選択可）</label>
              <div class="checkbox-grid">
                <label class="checkbox-label"><input type="checkbox" [(ngModel)]="uiModel.filters.inverse"> 反転</label>
                <label class="checkbox-label"><input type="checkbox" [(ngModel)]="uiModel.filters.hollow"> ぼかし</label>
                <label class="checkbox-label"><input type="checkbox" [(ngModel)]="uiModel.filters.blackPaint"> 黒塗り</label>
                <label class="checkbox-label"><input type="checkbox" [(ngModel)]="uiModel.filters.grayscale"> グレースケール</label>
              </div>
            </div>

            <div class="form-group">
              <label>カラー効果</label>
              <div class="color-effects-row">
                <div class="color-control">
                  <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="uiModel.aura.enabled"> オーラ
                  </label>
                  <input type="color" [(ngModel)]="uiModel.aura.color" [disabled]="!uiModel.aura.enabled">
                </div>
                <div class="color-control">
                  <label class="checkbox-label">
                    <input type="checkbox" [(ngModel)]="uiModel.backgroundColor.enabled"> 背景色
                  </label>
                  <input type="color" [(ngModel)]="uiModel.backgroundColor.color" [disabled]="!uiModel.backgroundColor.enabled">
                </div>
              </div>
            </div>
          </div>

          <hr>

          <!-- 機械的な効果セクション -->
          <div class="form-section">
            <div class="form-group">
              <label>効果の種類</label>
              <div class="radio-group">
                <label class="radio-label">
                  <input type="radio" name="effectType" [(ngModel)]="uiModel.effectType" value="attributeChange"> ラウンド毎の増減
                </label>
                <label class="radio-label">
                  <input type="radio" name="effectType" [(ngModel)]="uiModel.effectType" value="buffDebuff"> 能力値バフ/デバフ
                </label>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group target-param-group">
                <div class="form-label-container">
                  <label for="effect-target-param">対象パラメータ名</label>
                  <label class="checkbox-label sub-label">
                    <input type="checkbox" [checked]="!showAllParameters" (change)="toggleShowAllParameters()"> 共通のみ
                  </label>
                </div>
                <select id="effect-target-param" class="param-input" [(ngModel)]="uiModel.targetParam">
                  <option value="" disabled>パラメータを選択...</option>
                  <option *ngFor="let param of availableParameters" [value]="param.key">{{ param.name }}</option>
                </select>
              </div>
              <div class="form-group value-group">
                <label for="effect-value">変化量</label>
                <input id="effect-value" type="number" class="param-input" [(ngModel)]="uiModel.value" placeholder="例: -5">
              </div>
            </div>
          </div>

        </div>

        <!-- 空の状態 -->
        <div class="empty-state" *ngIf="!editingEffect">
          <p>左側のリストから効果を選択するか、<br>新規作成してください。</p>
        </div>
      </div>
    </div>
  </div>
</div>