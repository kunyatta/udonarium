<div class="panel-layout">
  <div class="layout-2pane">
    <!-- 左ペイン: リスト -->
    <div class="layout-sidebar">
      <div class="panel-header">
        <button class="udonarium-btn primary" style="width: 100%" (click)="createNew()">＋ 新規チャート</button>
      </div>
      <div class="panel-body" style="padding: 0; overflow-x: hidden;">
        <button *ngFor="let chart of charts" 
                class="list-item"
                [class.active]="selectedIdentifier === chart.identifier"
                (click)="selectChart(chart.identifier)">
          {{ chart.title || '(名称未設定)' }}
        </button>
        <div *ngIf="charts.length === 0" style="padding: var(--spacing-m); text-align: center; color: var(--text-color-secondary); font-size: 12px;">
          データがありません
        </div>
      </div>
      <div class="panel-footer">
        <button class="udonarium-btn" style="width: 100%" (click)="exportAll()">まとめて保存</button>
      </div>
    </div>

    <!-- 右ペイン: エディタ -->
    <div class="layout-main">
      <ng-container *ngIf="editingChart; else noSelection">
        <!-- 固定ヘッダー: チャート名と操作ボタン -->
        <div class="panel-header" style="justify-content: space-between;">
          <div style="font-weight: bold; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
            {{ editingChart.title }}
          </div>
          <div style="display: flex; gap: 4px;">
            <button class="udonarium-btn" (click)="export()">保存</button>
            <button class="udonarium-btn danger" (click)="delete()">削除</button>
          </div>
        </div>

        <!-- スクロールエリア: 設定項目 -->
        <div class="panel-body">
          <div class="info-card">
            <div style="font-weight: bold; margin-bottom: var(--spacing-s); font-size: 12px; color: var(--text-color-secondary);">基本設定</div>
            
            <div class="flex-row">
              <div class="flex-label">チャート名</div>
              <input type="text" class="udonarium-input" [(ngModel)]="editingChart.title" (change)="onChartChange()">
            </div>

            <div class="flex-row">
              <div class="flex-label">コマンド</div>
              <input type="text" class="udonarium-input" [(ngModel)]="editingChart.command" (change)="onChartChange()" placeholder="HAZARD_TABLE など">
            </div>

            <div class="flex-row">
              <div class="flex-label">使用ダイス</div>
              <input type="text" class="udonarium-input" [(ngModel)]="editingChart.dice" (change)="onChartChange()" placeholder="1d6, 2d6 など">
            </div>
          </div>

          <div class="info-card full-height">
            <div style="font-weight: bold; margin-bottom: var(--spacing-s); font-size: 12px; color: var(--text-color-secondary);">表の内容 (出目:結果)</div>
            <textarea class="udonarium-textarea" [(ngModel)]="editingChart.value" (change)="onChartChange()" 
                      placeholder="1:結果A&#10;2-5:結果B&#10;*:結果C"></textarea>
          </div>
        </div>
      </ng-container>

      <ng-template #noSelection>
        <div class="empty-state">
          <i class="material-icons empty-state-icon">auto_fix_high</i>
          <div class="empty-state-message">チャートを選択するか、新規作成してください</div>
          <div class="empty-state-description">
            ダイスの出目によって結果が変わる複雑な表を自動化します
          </div>
        </div>
      </ng-template>
    </div>
  </div>
</div>
