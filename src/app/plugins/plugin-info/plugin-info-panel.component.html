<div class="panel-layout">
  
  <!-- Detail View Mode -->
  <ng-container *ngIf="selectedPlugin; else gridView">
    
    <div class="panel-header">
      <button class="udonarium-btn" (click)="clearSelection()">
        <i class="material-icons">arrow_back</i>
      </button>
      <div class="detail-header-content">
        <i [ngClass]="selectedPlugin.manifest?.iconClass || selectedPlugin.iconClass || 'material-icons'" class="detail-icon">{{ selectedPlugin.manifest?.icon || selectedPlugin.icon || 'open_in_new' }}</i>
        <span class="detail-title">{{ selectedPlugin.manifest?.name || selectedPlugin.name }}</span>
      </div>
    </div>

    <div class="panel-body">
      <div class="info-card detail-content">
        
        <div class="meta-info">
          <div>
            <strong>Version:</strong> {{ selectedPlugin.manifest?.version || selectedPlugin.version || 'Unknown' }}
          </div>
          <!-- 将来的に Author や UpdateDate を追加可能 -->
        </div>

        <div class="description-area" [innerHTML]="(selectedPlugin.manifest?.description || selectedPlugin.description || 'No description available.') | autolink">
        </div>

        <!-- Tutorial Image Area -->
        <div class="tutorial-image-area" *ngIf="selectedPlugin.manifest?.tutorialImage">
          <img [src]="'assets/plugins/' + (selectedPlugin.manifest?.path || selectedPlugin.pluginName) + '/' + selectedPlugin.manifest.tutorialImage" class="tutorial-image" alt="Tutorial">
        </div>

        <!-- Changelog Area -->
        <div class="changelog-area" *ngIf="selectedPlugin.manifest?.changelog?.length">
          <div class="changelog-title">Update History</div>
          <ul class="changelog-list">
            <li *ngFor="let log of selectedPlugin.manifest?.changelog" class="changelog-item">
              <div class="log-header" *ngIf="log.version || log.date">
                <span *ngIf="log.version" class="log-version">v{{ log.version }}</span>
                <span *ngIf="log.date" class="log-date">{{ log.date }}</span>
              </div>
              <div class="log-content" [innerHTML]="log.content | autolink"></div>
            </li>
          </ul>
        </div>

        <div class="action-area" *ngIf="selectedPlugin.manifest?.isExperimental || selectedPlugin.isExperimental">
          <button class="udonarium-btn accent" (click)="openPluginPanel(selectedPlugin)">
            <i class="material-icons launch-icon">play_arrow</i> Launch Plugin
          </button>
          <div class="warning-text">※ This is an experimental plugin.</div>
        </div>
      </div>
    </div>
  </ng-container>

  <!-- Grid View Mode -->
  <ng-template #gridView>
    <div class="panel-body">
      <ul class="grid-container">
        <!-- Loop through registered UIs -->
        <ng-container *ngFor="let ui of pluginUIs">

          <!-- Case: Any Plugin (Grid Item) -->
          <li class="grid-item" (click)="selectPlugin(ui)" [class.active]="ui.isActive">
            <a class="grid-link">
              <div class="icon-container">
                <i [ngClass]="ui.manifest?.iconClass || ui.iconClass || 'material-icons'" class="icon-size">{{ ui.manifest?.icon || ui.icon || 'extension' }}</i>
                <div *ngIf="ui.manifest?.isExperimental || ui.isExperimental" class="badge-experimental" title="Experimental">E</div>
              </div>
              <div class="item-label">{{ ui.manifest?.name || ui.name }}</div>
            </a>
          </li>

        </ng-container>
      </ul>
    </div>
  </ng-template>

  <div class="panel-footer">
    <div class="mod-version-info">
      Udonarium v{{ MOD_MANIFEST.basedOn }} | Mod v{{ MOD_MANIFEST.version }}
      <span *ngIf="!isProduction" class="dev-launch-time"> [Start: {{ launchTime }}]</span>
    </div>
  </div>

</div>
