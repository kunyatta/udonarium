<div class="tabs">
  <div class="tab-item" [class.active]="selectedTab === 'global'" (click)="selectTab('global')">全体設定</div>
  <div class="tab-item" [class.active]="selectedTab === 'emotes'" (click)="selectTab('emotes')">エモート管理</div>
</div>

<div class="setting-container" *ngIf="selectedTab === 'global'">
  <h3>立ち絵演出設定 (Master Control)</h3>
  
  <div class="setting-group">
    <label>表示持続時間 (ms): <span>{{config.displayDuration}}</span></label>
    <input type="range" min="1000" max="20000" step="500" [(ngModel)]="config.displayDuration" (change)="updateConfig()">
  </div>

  <div class="setting-group">
    <label>アニメーション速度 (ms): <span>{{config.animationDuration}}</span></label>
    <input type="range" min="100" max="2000" step="50" [(ngModel)]="config.animationDuration" (change)="updateConfig()">
  </div>

  <div class="setting-group">
    <label>文字表示速度 (ms/文字): <span>{{config.typingSpeed}}</span></label>
    <small style="display: block; color: #ccc;">(0で即時表示。推奨: 30-70)</small>
    <input type="range" min="0" max="200" step="5" [(ngModel)]="config.typingSpeed" (change)="updateConfig()">
  </div>

  <hr>

  <div class="setting-group">
    <label>押し出し幅 (vw): <span>{{config.slideWidth}}</span></label>
    <input type="range" min="5" max="40" step="1" [(ngModel)]="config.slideWidth" (change)="updateConfig()">
  </div>

  <div class="setting-group">
    <label>画面端からの距離 (vw): <span>{{config.edgeOffset}}</span></label>
    <input type="range" min="0" max="30" step="1" [(ngModel)]="config.edgeOffset" (change)="updateConfig()">
  </div>

  <hr>

  <div class="setting-group">
    <label>立ち絵の標準幅 (vw): <span>{{config.standWidth}}</span></label>
    <input type="range" min="10" max="50" step="1" [(ngModel)]="config.standWidth" (change)="updateConfig()">
  </div>

  <div class="setting-group">
    <label>立ち絵の標準高さ (vh): <span>{{config.standHeight}}</span></label>
    <input type="range" min="20" max="100" step="1" [(ngModel)]="config.standHeight" (change)="updateConfig()">
  </div>

  <div class="setting-group">
    <label>エモートの大きさ (scale): <span>{{config.emoteSize}}</span></label>
    <input type="range" min="1" max="10" step="0.1" [(ngModel)]="config.emoteSize" (change)="updateConfig()">
  </div>

  <div class="footer">
    <p>※ 設定はリアルタイムに反映されます。</p>
  </div>
</div>

<div class="emote-manager-container" *ngIf="selectedTab === 'emotes'">
  <!-- Left Column: List -->
  <div class="emote-list-col">
    <div class="list-header">
      <button class="add-btn" (click)="createNewEmote()">+ 新規追加</button>
      <button class="btn btn-outline-secondary btn-sm" style="width: 100%; margin-top: 4px;" (click)="exportAllEmotes()">辞書を一括保存</button>
    </div>
    <div class="scrollable-list">
      <div *ngFor="let emote of emotes; let i = index" class="list-item" 
           [class.active]="selectedEmote?.identifier === emote.identifier"
           (click)="selectEmote(emote)">
        <span class="icon">{{emote.icon}}</span>
        <span class="label">{{emote.label}}</span>
        <div class="move-btns">
          <button [disabled]="i === 0" (click)="moveEmote($event, emote, -1)">▲</button>
          <button [disabled]="i === emotes.length - 1" (click)="moveEmote($event, emote, 1)">▼</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Right Column: Editor -->
  <div class="emote-editor-col">
    <div *ngIf="selectedEmote; else noSelection">
      <h3>エモート編集</h3>
      <div class="form-group">
        <label>アイコン (絵文字/テキスト)</label>
        <input type="text" [(ngModel)]="selectedEmote.icon" (change)="onEmoteChange()" placeholder="😊">
      </div>
      <div class="form-group">
        <label>表示名 (メニュー用)</label>
        <input type="text" [(ngModel)]="selectedEmote.label" (change)="onEmoteChange()" placeholder="笑顔">
      </div>
      <div class="form-group">
        <label>効果音 (SE)</label>
        <select [(ngModel)]="selectedEmote.soundIdentifier" (change)="onEmoteChange()">
          <option value="">設定なし</option>
          <option *ngFor="let audio of audios" [value]="audio.identifier">{{audio.name}}</option>
        </select>
      </div>

      <div class="button-row" style="margin-top: 20px;">
        <button class="btn btn-outline-primary" (click)="exportEmote()">個別保存</button>
        <button class="btn btn-outline-danger" (click)="deleteEmote()">削除</button>
        <button class="btn btn-outline-secondary" (click)="cancelEdit()">閉じる</button>
      </div>
      <div class="footer" style="margin-top: 10px;">
        <p class="small text-muted">※ 編集内容は自動的に保存・同期されます。</p>
      </div>
    </div>
    <ng-template #noSelection>
      <div class="placeholder">
        <p>左のリストから選択するか<br>新規追加してください</p>
      </div>
    </ng-template>
  </div>
</div>
