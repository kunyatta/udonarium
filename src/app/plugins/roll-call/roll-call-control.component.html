<div class="panel-content">
  
  <div class="control-group">
    <label>通知先タブ:</label>
    <select [(ngModel)]="targetTabIdentifier">
      <option *ngFor="let tab of chatTabs" [value]="tab.identifier">{{ tab.name }}</option>
    </select>
  </div>
  <hr>

  <!-- 待機画面: 設定モード -->
  <ng-container *ngIf="!isRunning">
    <div class="tab-header">
      <button [class.active]="selectedTab === 'roll-call'" (click)="selectTab('roll-call')">点呼</button>
      <button [class.active]="selectedTab === 'poll'" (click)="selectTab('poll')">投票</button>
    </div>

    <div class="settings-body">
      <!-- 点呼モード: タイトルなし -->
      <!-- 投票モード: タイトルあり -->
      <div class="input-group" *ngIf="selectedTab === 'poll'">
        <label>タイトル:</label>
        <input type="text" [(ngModel)]="title" placeholder="タイトルを入力">
      </div>

      <!-- 共通設定 -->
      <div class="input-group checkbox">
        <input type="checkbox" id="includeOwner" [(ngModel)]="includeOwner">
        <label for="includeOwner">自分を含める</label>
      </div>

      <!-- 投票モードの場合の選択肢設定 -->
      <div *ngIf="selectedTab === 'poll'" class="poll-settings">
        <label>選択肢:</label>
        <div class="choice-input">
          <input type="text" [(ngModel)]="newChoice" (keydown.enter)="addChoice()" placeholder="選択肢を追加">
          <button (click)="addChoice()">+</button>
        </div>
        <ul class="choice-list">
          <li *ngFor="let choice of pollChoices; let i = index">
            {{ choice }} <span class="remove-choice" (click)="removeChoice(i)">×</span>
          </li>
        </ul>
      </div>

      <div class="actions">
        <button (click)="startActivity()">開始</button>
      </div>
    </div>
  </ng-container>

  <!-- 進行中画面 (管理用: 状況表示と強制終了) -->
  <ng-container *ngIf="isRunning">
    <div class="status-header">
      <div class="status-title">{{ voteTitle }}</div>
      <div class="status-badge running">進行中</div>
    </div>
    
    <hr>

    <div class="participants-list">
      <div class="participant-header">回答状況</div>
      <div class="participant-row" *ngFor="let peer of peers">
        <div class="peer-icon">
          <img *ngIf="peer.image" [src]="peer.image.url | safe: 'resourceUrl'">
          <span *ngIf="!peer.image" class="no-icon">?</span>
        </div>
        <div class="peer-name">{{ peer.name }}</div>
        <div class="peer-status">
          <span class="status-text" 
            [class.status-none]="rollCallService.getAnswerState(peer.peerId) === 0"
            [class.status-done]="rollCallService.getAnswerState(peer.peerId) > 0">
            {{ getAnswerText(rollCallService.getAnswerState(peer.peerId)) }}
          </span>
        </div>
      </div>
    </div>

    <div class="owner-actions">
      <hr>
      <button class="danger" (click)="stopActivity()">強制終了</button>
    </div>
  </ng-container>

</div>
